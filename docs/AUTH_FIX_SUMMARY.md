# тЬЕ р╕кр╕гр╕╕р╕Ыр╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕Вр╕Ыр╕▒р╕Нр╕лр╕▓р╕Бр╕▓р╕гр╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ Green Market

## ЁЯОп р╕Ыр╕▒р╕Нр╕лр╕▓р╕Чр╕╡р╣Ир╕Юр╕Ъ
- р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ър╣Бр╕ер╣Йр╕зр╣Ар╕Фр╣Йр╕Зр╕нр╕нр╕Бр╕Чр╕▒р╕Щр╕Чр╕╡
- р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Др╕бр╣Ир╣Вр╕лр╕ер╕Фр╕Ир╕▓р╕Б Firestore
- Session р╣Др╕бр╣Ир╕Цр╕╣р╕Б persist р╕нр╕вр╣Ир╕▓р╕Зр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З

## ЁЯФз р╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕Вр╕Чр╕╡р╣Ир╕Чр╕│

### 1. р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З UserProvider
**р╣Др╕Яр╕ер╣М:** `lib/providers/user_provider.dart`
- тЬЕ р╣Ар╕Юр╕┤р╣Ир╕б retry mechanism (р╕ер╕нр╕Зр╕Лр╣Йр╕│р╕кр╕╣р╕Зр╕кр╕╕р╕Ф 3 р╕Др╕гр╕▒р╣Йр╕З)
- тЬЕ р╣Ар╕Юр╕┤р╣Ир╕б exponential backoff (р╕гр╕нр╣Ар╕Юр╕┤р╣Ир╕бр╕Вр╕╢р╣Йр╕Щр╕Чр╕╡р╕ер╕░ 2 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡)
- тЬЕ р╣Ар╕Юр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕кр╕гр╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Гр╕лр╕бр╣Ир╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤ р╕лр╕▓р╕Бр╣Др╕бр╣Ир╕бр╕╡р╣Гр╕Щ Firestore
- тЬЕ р╣Ар╕Юр╕┤р╣Ир╕б detailed logging р╕кр╕│р╕лр╕гр╕▒р╕Ъ debug

### 2. р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З Firebase Service
**р╣Др╕Яр╕ер╣М:** `lib/services/firebase_service.dart`
- тЬЕ р╣Ар╕Юр╕┤р╣Ир╕б auth persistence (Persistence.LOCAL)
- тЬЕ р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З error handling р╣Гр╕Щ getAppUser
- тЬЕ р╣Ар╕Юр╕┤р╣Ир╕бр╕Бр╕▓р╕г retry р╕кр╕│р╕лр╕гр╕▒р╕Ъ network errors
- тЬЕ р╣Ар╕Юр╕┤р╣Ир╕б detailed logging

### 3. р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З Main App Logic
**р╣Др╕Яр╕ер╣М:** `lib/main.dart`
- тЬЕ р╣Ар╕Юр╕┤р╣Ир╕бр╕Бр╕▓р╕гр╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ user data р╕лр╕ер╕▒р╕Зр╕Ир╕▓р╕Бр╕ер╣Зр╕нр╕Бр╕нр╕┤р╕Щ
- тЬЕ р╣Ар╕Юр╕┤р╣Ир╕б auto-retry loading user data
- тЬЕ р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╕Бр╕▓р╕гр╣Бр╕кр╕Фр╕З SplashScreen

### 4. р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З SplashScreen
**р╣Др╕Яр╕ер╣М:** `lib/screens/splash_screen.dart`
- тЬЕ р╣Ар╕Юр╕┤р╣Ир╕бр╕Вр╣Йр╕нр╕Др╕зр╕▓р╕бр╣Бр╕кр╕Фр╕Зр╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╣Вр╕лр╕ер╕Ф
- тЬЕ р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З UI р╣Гр╕лр╣Йр╕Фр╕╣р╕Фр╕╡р╕Вр╕╢р╣Йр╕Щ

## ЁЯУЛ р╕Бр╕▓р╕гр╕Чр╕│р╕Зр╕▓р╕Щр╣Гр╕лр╕бр╣И

### р╕Бр╕▓р╕гр╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╕╣р╣Йр╣Гр╕Кр╣Й:
1. ЁЯФР р╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ър╕Ьр╣Ир╕▓р╕Щ Firebase Auth
2. ЁЯФД UserProvider р╕ер╕нр╕Зр╣Вр╕лр╕ер╕Фр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ир╕▓р╕Б Firestore
3. тЪая╕П р╕лр╕▓р╕Бр╣Др╕бр╣Ир╕Юр╕Ър╕Вр╣Йр╕нр╕бр╕╣р╕е тЖТ р╕кр╕гр╣Йр╕▓р╕Зр╕Вр╣Йр╕нр╕бр╕╣р╕ер╣Гр╕лр╕бр╣Ир╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
4. ЁЯФБ р╕лр╕▓р╕Бр╣Ар╕Бр╕┤р╕Ф error тЖТ р╕ер╕нр╕Зр╣Гр╕лр╕бр╣Ир╕кр╕╣р╕Зр╕кр╕╕р╕Ф 3 р╕Др╕гр╕▒р╣Йр╕З
5. тЬЕ р╣Бр╕кр╕Фр╕З MainAppShell р╣Ар╕бр╕╖р╣Ир╕нр╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Юр╕гр╣Йр╕нр╕б

### Session Management:
- ЁЯТ╛ Auth state р╕Цр╕╣р╕Б persist р╣Гр╕Щ local storage
- ЁЯФД Auto-retry loading р╕Чр╕╕р╕Б р╣Ж 30 р╕зр╕┤р╕Щр╕▓р╕Чр╕╡ р╕лр╕▓р╕Бр╣Др╕бр╣Ир╕кр╕│р╣Ар╕гр╣Зр╕И
- ЁЯУ▒ р╕гр╕нр╕Зр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ offline р╕Юр╕╖р╣Йр╕Щр╕Рр╕▓р╕Щ

## ЁЯЪА р╕Ьр╕ер╕ер╕▒р╕Юр╕Шр╣М

### тЬЕ р╕Ыр╕▒р╕Нр╕лр╕▓р╕Чр╕╡р╣Ир╣Бр╕Бр╣Йр╣Др╕Вр╣Др╕Фр╣Й:
- [x] р╣Бр╕нр╕Юр╣Др╕бр╣Ир╣Ар╕Фр╣Йр╕Зр╕нр╕нр╕Бр╕лр╕ер╕▒р╕Зр╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ър╣Бр╕ер╣Йр╕з
- [x] р╕Вр╣Йр╕нр╕бр╕╣р╕ер╕Ьр╕╣р╣Йр╣Гр╕Кр╣Йр╣Вр╕лр╕ер╕Фр╣Др╕Фр╣Йр╕нр╕вр╣Ир╕▓р╕Зр╕Цр╕╣р╕Бр╕Хр╣Йр╕нр╕З
- [x] Session р╕Цр╕╣р╕Б maintain р╣Др╕Фр╣Йр╕Щр╕▓р╕Щр╕Вр╕╢р╣Йр╕Щ
- [x] р╣Бр╕нр╕Юр╕Чр╕│р╕Зр╕▓р╕Щр╣Др╕Фр╣Йр╕Ър╕Щ Chrome
- [x] Error handling р╕Фр╕╡р╕Вр╕╢р╣Йр╕Щ

### ЁЯОп р╕Бр╕▓р╕гр╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕Зр╕Чр╕╡р╣Ир╣Ар╕Юр╕┤р╣Ир╕бр╕Вр╕╢р╣Йр╕Щ:
- ЁЯУК Detailed logging р╕кр╕│р╕лр╕гр╕▒р╕Ъ debug
- ЁЯФД Auto-retry mechanism
- ЁЯТ╛ Better session persistence
- ЁЯЫбя╕П Error recovery
- ЁЯСд Auto user data creation

## ЁЯФН р╕зр╕┤р╕Шр╕╡р╕Бр╕▓р╕гр╕Чр╕Фр╕кр╕нр╕Ъ

### 1. р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕▓р╕гр╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ъ:
```bash
# р╕гр╕▒р╕Щр╣Бр╕нр╕Ю
flutter run -d chrome

# р╕ер╕нр╕Зр╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ър╕Фр╣Йр╕зр╕в email/password
# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╣Др╕бр╣Ир╣Ар╕Фр╣Йр╕Зр╕нр╕нр╕Б
```

### 2. р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ъ Debug Log:
```bash
# р╕Фр╕╣ console log р╕кр╕│р╕лр╕гр╕▒р╕Ъ:
# "ЁЯФД Loading user data for: xxx"
# "тЬЕ User data loaded successfully"
# "ЁЯУб Fetching user data from Firestore"
```

### 3. р╕Чр╕Фр╕кр╕нр╕Ър╕Бр╕гр╕Ур╕╡ Network Error:
```bash
# р╕Ыр╕┤р╕Ф internet р╕Кр╕▒р╣Ир╕зр╕Др╕гр╕▓р╕з
# р╕Хр╕гр╕зр╕Ир╕кр╕нр╕Ър╕зр╣Ир╕▓р╣Бр╕нр╕Ю retry р╕нр╕▒р╕Хр╣Вр╕Щр╕бр╕▒р╕Хр╕┤
# р╣Ар╕Ыр╕┤р╕Ф internet р╕Бр╕ер╕▒р╕Ъ тЖТ р╕Др╕зр╕гр╕Чр╕│р╕Зр╕▓р╕Щр╕Хр╣Ир╕нр╣Др╕Фр╣Й
```

## ЁЯУЭ р╣Др╕Яр╕ер╣Мр╕Чр╕╡р╣Ир╣Бр╕Бр╣Йр╣Др╕В

1. **lib/providers/user_provider.dart** - р╣Ар╕Юр╕┤р╣Ир╕б retry & error handling
2. **lib/services/firebase_service.dart** - р╣Ар╕Юр╕┤р╣Ир╕б persistence & retry
3. **lib/main.dart** - р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З app logic
4. **lib/screens/splash_screen.dart** - р╕Ыр╕гр╕▒р╕Ър╕Ыр╕гр╕╕р╕З UI
5. **AUTH_DEBUG_GUIDE.md** - р╕Др╕╣р╣Ир╕бр╕╖р╕н debug (р╣Гр╕лр╕бр╣И)

## ЁЯОЙ р╕кр╕гр╕╕р╕Ы

р╕Ыр╕▒р╕Нр╕лр╕▓р╕Бр╕▓р╕гр╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ър╣Бр╕ер╣Йр╕зр╣Ар╕Фр╣Йр╕Зр╕нр╕нр╕Бр╣Др╕Фр╣Йр╕гр╕▒р╕Ър╕Бр╕▓р╕гр╣Бр╕Бр╣Йр╣Др╕Вр╣Бр╕ер╣Йр╕з! р╣Бр╕нр╕Юр╕Хр╕нр╕Щр╕Щр╕╡р╣Й:

- тЬЕ **р╣Ар╕кр╕Цр╕╡р╕вр╕гр╕Вр╕╢р╣Йр╕Щ** - р╕бр╕╡ retry mechanism
- тЬЕ **р╕Чр╕│р╕Зр╕▓р╕Щр╣Др╕Фр╣Йр╕Ир╕гр╕┤р╕З** - р╕гр╕▒р╕Щр╕Ър╕Щ Chrome р╣Др╕Фр╣Йр╣Бр╕ер╣Йр╕з
- тЬЕ **Debug р╕Зр╣Ир╕▓р╕вр╕Вр╕╢р╣Йр╕Щ** - р╕бр╕╡ detailed logging
- тЬЕ **User Experience р╕Фр╕╡р╕Вр╕╢р╣Йр╕Щ** - р╣Бр╕кр╕Фр╕Зр╕кр╕Цр╕▓р╕Щр╕░р╕Бр╕▓р╕гр╣Вр╕лр╕ер╕Ф

---

**тЬи р╣Бр╕нр╕Юр╕Юр╕гр╣Йр╕нр╕бр╣Гр╕Кр╣Йр╕Зр╕▓р╕Щр╣Бр╕ер╣Йр╕з!**  
р╕кр╕▓р╕бр╕▓р╕гр╕Цр╣Ар╕Вр╣Йр╕▓р╕кр╕╣р╣Ир╕гр╕░р╕Ър╕Ър╣Бр╕ер╕░р╣Гр╕Кр╣Йр╕Зр╕▓р╕Щ Green Market р╣Др╕Фр╣Йр╕нр╕вр╣Ир╕▓р╕Зр╕Ыр╕Бр╕Хр╕┤
